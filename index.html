<!-- index.html - ç”Ÿæ—¥ç¥ç¦ç®€æ˜“é¡µï¼ˆå•æ–‡ä»¶ï¼‰ -->
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ç”Ÿæ—¥å¿«ä¹ ğŸ‚</title>
    <style>
      :root {
        --bg1: #ffecd2;
        --bg2: #fcb69f;
        --accent: #ff6b6b;
        --card-bg: rgba(255, 255, 255, 0.85);
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, var(--bg1), var(--bg2));
      }
      .wrap {
        min-height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        box-sizing: border-box;
      }
      .card {
        width: 100%;
        max-width: 920px;
        background: var(--card-bg);
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        backdrop-filter: blur(6px);
        position: relative;
        overflow: hidden;
      }
      header {
        display: flex;
        gap: 20px;
        align-items: center;
      }
      .avatar {
        width: 96px;
        height: 96px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.3)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: var(--accent);
        flex-shrink: 0;
        border: 4px solid rgba(255, 255, 255, 0.6);
      }
      h1 {
        margin: 0;
        font-size: 28px;
      }
      p.lead {
        margin: 6px 0 0;
        color: #333;
        opacity: 0.9;
      }
      .controls {
        margin-top: 18px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      button {
        padding: 10px 14px;
        border-radius: 10px;
        border: 0;
        background: var(--accent);
        color: white;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
      }
      .secondary {
        background: transparent;
        color: var(--accent);
        border: 2px solid rgba(0, 0, 0, 0.06);
      }
      .message-area {
        margin-top: 22px;
        font-size: 20px;
        line-height: 1.4;
        color: #222;
        padding: 18px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.6);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }
      .footer {
        margin-top: 18px;
        font-size: 13px;
        color: #555;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }
      .small {
        font-size: 12px;
        color: #666;
      }
      .share {
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.3)
        );
        padding: 8px 10px;
        border-radius: 8px;
      }
      .palette {
        display: flex;
        gap: 8px;
      }
      .swatch {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        cursor: pointer;
        border: 2px solid rgba(255, 255, 255, 0.6);
      }
      /* confetti canvas full-screen inside card */
      canvas#confetti {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
      }
      /* simple responsive */
      @media (max-width: 560px) {
        .avatar {
          width: 72px;
          height: 72px;
          font-size: 30px;
        }
        h1 {
          font-size: 22px;
        }
        .message-area {
          font-size: 17px;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card" id="card">
        <canvas id="confetti"></canvas>
        <header>
          <div class="avatar" id="avatar">ğŸ‰</div>
          <div>
            <h1 id="headline">ç”Ÿæ—¥å¿«ä¹ï¼</h1>
            <p class="lead" id="sub">ä¸ºä½ å‡†å¤‡äº†ä¸€äº›æƒŠå–œã€œ</p>
            <div class="controls">
              <button id="surpriseBtn">ç‚¹æˆ‘æŠ½ä¸€æ¡ç¥ç¦ âœ¨</button>
              <button id="musicBtn" class="secondary">æ’­æ”¾éšæœºæ­Œæ›² â–¶</button>
              <button id="fixBtn" class="secondary">ç”Ÿæˆåˆ†äº«é“¾æ¥ ğŸ”—</button>
            </div>
          </div>
        </header>

        <div class="message-area" id="message">
          ç¥ç¦è¯­ä¼šå‡ºç°åœ¨è¿™é‡Œï¼Œç¥ä½ å¤©å¤©å¼€å¿ƒï½
        </div>

        <div class="footer">
          <div class="palette" id="palette"></div>
          <div style="display: flex; gap: 8px; align-items: center">
            <span class="small">éšæœºèƒŒæ™¯ Â· é…è‰² Â· éŸ³ä¹</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* ========== é…ç½®åŒºï¼šåœ¨è¿™é‡Œæ”¾ä½ çš„ 10 æ¡ç¥ç¦å’Œ 10 ä¸ªéŸ³é¢‘ï¼ˆæœ¬åœ°ç›¸å¯¹è·¯å¾„æˆ–å¤–é“¾ï¼‰ ========== */
      const MESSAGES = [
        "æ„¿ä½ çš„æ¯ä¸€å¹´éƒ½æ¯”å»å¹´æ›´ç²¾å½©ï¼Œç”Ÿæ—¥å¿«ä¹ï¼",
        "æ„¿å¿«ä¹ä¸å¹¸ç¦å¸¸ä¼´ä½ å·¦å³ï¼Œæ„¿æœ›éƒ½èƒ½å®ç°ï¼",
        "ä»Šå¤©ä½ æ˜¯ä¸»è§’ï¼Œæ”¾è‚†è¢«å® çˆ±ï¼Œè¢«ç¥ç¦å§ï¼",
        "æ„¿æ‰€æœ‰ç¾å¥½å¦‚æœŸè€Œè‡³ï¼Œå²å²å¹³å®‰ï¼Œç”Ÿæ—¥å¿«ä¹ï¼",
        "åœ¨ä½ äººç”Ÿçš„è¿™ä¸€å¤©ï¼Œæ„¿å…‰èŠ’ä¸ºä½ è€Œæ¥ï¼Œæ¸©æŸ”é™ªä¼´ä½ ã€‚",
        "ç¥ä½ çƒ­çˆ±ç”Ÿæ´»ï¼Œæ°¸è¿œä¿æŒå¥½å¥‡ä¸å‹‡æ°”ï¼",
        "æ–°çš„ä¸€å²ï¼Œæ–°çš„å†’é™©ï¼Œæ–°çš„æƒŠå–œï¼Œç»§ç»­å‘å‰å†²ï¼",
        "æ„¿ä½ ç¬‘å£å¸¸å¼€ï¼Œçƒ¦æ¼è¿œç¦»ï¼Œå¹¸ç¦è¶Šæ¥è¶Šå¤šï¼",
        "æ„¿å¥åº·ã€å¥½è¿ä¸çˆ±ä¸€è·¯åŒè¡Œï¼Œç”Ÿæ—¥å¿«ä¹ï¼",
        "è°¢è°¢ä½ å­˜åœ¨äºæˆ‘ä»¬ç”Ÿæ´»é‡Œï¼Œæ„¿ä½ è¢«å¥½äº‹ç¯ç»•ã€‚",
      ];
      // audioList æ”¯æŒæœ¬åœ°ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èæŠŠ audio/01.mp3 ... æ”¾åœ¨ä»“åº“ï¼‰æˆ–å¤–é“¾ï¼ˆæ³¨æ„ç‰ˆæƒï¼‰
      const AUDIO_LIST = [
        "audio/01.mp3",
        "audio/02.mp3",
        "audio/03.mp3",
        "audio/04.mp3",
        "audio/05.mp3",
        "audio/06.mp3",
      ];
      /* ========== ç»“æŸé…ç½®åŒº ========== */

      /* é¢œè‰²ä¸»é¢˜ï¼ˆæ¯ä¸ªä¸»é¢˜åŒ…å«ä¸¤ä¸ªæ¸å˜è‰² + accentï¼‰ */
      const PALETTES = [
        ["#FFEDD5", "#FECACA", "#EF4444"],
        ["#F0F9FF", "#CFFAFE", "#0369A1"],
        ["#FEF3C7", "#FDE68A", "#D97706"],
        ["#ECFCCB", "#D9F99D", "#16A34A"],
        ["#F5F3FF", "#EDE9FE", "#7C3AED"],
        ["#FFF1F2", "#FFE4E6", "#DB2777"],
      ];

      const qs = new URLSearchParams(location.search);
      const presetMsgIdx = qs.get("msg"); // optional index to force a message
      const presetSongIdx = qs.get("song"); // optional index to force a song
      const presetPalette = qs.get("palette"); // optional palette idx

      const messageEl = document.getElementById("message");
      const headline = document.getElementById("headline");
      const sub = document.getElementById("sub");
      const surpriseBtn = document.getElementById("surpriseBtn");
      const musicBtn = document.getElementById("musicBtn");
      const fixBtn = document.getElementById("fixBtn");
      const paletteEl = document.getElementById("palette");
      const card = document.getElementById("card");
      const avatar = document.getElementById("avatar");

      let current = {
        msgIdx: null,
        songIdx: null,
        paletteIdx: null,
        audioEl: null,
      };

      function pickRandom(arr) {
        return Math.floor(Math.random() * arr.length);
      }

      function applyPalette(idx) {
        const p = PALETTES[idx];
        document.documentElement.style.setProperty("--bg1", p[0]);
        document.documentElement.style.setProperty("--bg2", p[1]);
        document.documentElement.style.setProperty("--accent", p[2]);
        current.paletteIdx = idx;
        // avatar border color update
        avatar.style.borderColor = hexToRgba(p[2], 0.6);
      }

      /* small helper */
      function hexToRgba(hex, a) {
        const c = hex.replace("#", "");
        const r = parseInt(c.substring(0, 2), 16);
        const g = parseInt(c.substring(2, 4), 16);
        const b = parseInt(c.substring(4, 6), 16);
        return `rgba(${r},${g},${b},${a})`;
      }

      /* show message with tiny animation */
      function showMessage(i) {
        const text = MESSAGES[i] || "ç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼";
        headline.innerText = "ç”Ÿæ—¥å¿«ä¹ ğŸ‚";
        messageEl.style.opacity = 0;
        setTimeout(() => {
          messageEl.innerText = text;
          messageEl.style.opacity = 1;
        }, 220);
        current.msgIdx = i;
        // occasional emoji avatar change
        const emojis = ["ğŸ‰", "ğŸ¥³", "ğŸ‚", "ğŸ’«", "âœ¨", "ğŸˆ"];
        avatar.innerText = emojis[i % emojis.length];
      }

      /* music handling */
      function playSong(i) {
        if (current.audioEl) {
          current.audioEl.pause();
          current.audioEl.remove();
          current.audioEl = null;
        }
        const src = AUDIO_LIST[i];
        if (!src) {
          alert("æ²¡æœ‰å¯ç”¨çš„éŸ³é¢‘èµ„æº");
          return;
        }
        const audio = document.createElement("audio");
        audio.src = src;
        audio.controls = true;
        audio.autoplay = true;
        audio.style.marginLeft = "10px";
        // ensure user action first (browsers may block autoplay)
        audio.play().catch(() => {
          alert("æµè§ˆå™¨é˜»æ­¢è‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®ä»¥å¼€å§‹éŸ³ä¹ã€‚");
        });
        musicBtn.after(audio);
        current.audioEl = audio;
        current.songIdx = i;
      }

      /* share link (å›ºå®šå½“å‰éšæœºé€‰æ‹©) */
      function makeShareLink() {
        const base = location.origin + location.pathname;
        const params = new URLSearchParams();
        if (current.msgIdx != null) params.set("msg", current.msgIdx);
        if (current.songIdx != null) params.set("song", current.songIdx);
        if (current.paletteIdx != null)
          params.set("palette", current.paletteIdx);
        const url = base + "?" + params.toString();
        navigator.clipboard
          ?.writeText(url)
          .then(() => {
            alert("åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
          })
          .catch(() => {
            prompt("å¤åˆ¶ä¸‹é¢çš„é“¾æ¥ï¼š", url);
          });
      }

      /* render palette selectors */
      function renderPaletteSelectors() {
        PALETTES.forEach((p, idx) => {
          const s = document.createElement("div");
          s.className = "swatch";
          s.title = `é…è‰² ${idx + 1}`;
          s.style.background = `linear-gradient(135deg, ${p[0]}, ${p[1]})`;
          s.onclick = () => {
            applyPalette(idx);
          };
          paletteEl.appendChild(s);
        });
      }

      /* confetti simple implementation */
      function burstConfetti() {
        const canvas = document.getElementById("confetti");
        const ctx = canvas.getContext("2d");
        const dpr = window.devicePixelRatio || 1;
        canvas.width = card.clientWidth * dpr;
        canvas.height = card.clientHeight * dpr;
        canvas.style.width = card.clientWidth + "px";
        canvas.style.height = card.clientHeight + "px";
        ctx.scale(dpr, dpr);
        let pieces = [];
        const colors = [
          getComputedStyle(document.documentElement).getPropertyValue(
            "--accent"
          ) || "#ff6b6b",
          "#ffd166",
          "#06d6a0",
          "#4cc9f0",
        ];
        for (let i = 0; i < 80; i++) {
          pieces.push({
            x: Math.random() * card.clientWidth,
            y: (Math.random() * card.clientHeight) / 2,
            r: 6 + Math.random() * 8,
            dx: -3 + Math.random() * 6,
            dy: 1 + Math.random() * 4,
            color: colors[Math.floor(Math.random() * colors.length)],
            rot: Math.random() * 360,
            rotd: -5 + Math.random() * 10,
          });
        }
        let t = 0;
        function frame() {
          ctx.clearRect(0, 0, card.clientWidth, card.clientHeight);
          pieces.forEach((p) => {
            p.x += p.dx;
            p.y += p.dy + Math.sin(t / 10) * 0.5;
            p.rot += p.rotd;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate((p.rot * Math.PI) / 180);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.r / 2, -p.r / 2, p.r, p.r * 0.6);
            ctx.restore();
          });
          t++;
          pieces = pieces.filter((p) => p.y < card.clientHeight + 20);
          if (pieces.length > 0) requestAnimationFrame(frame);
          else ctx.clearRect(0, 0, card.clientWidth, card.clientHeight);
        }
        frame();
      }

      /* initialization */
      function init() {
        renderPaletteSelectors();
        // apply preset palette or random
        const pIdx =
          presetPalette !== null &&
          presetPalette !== undefined &&
          PALETTES[presetPalette]
            ? Number(presetPalette)
            : pickRandom(PALETTES);
        applyPalette(pIdx);
        // choose message and song
        const msgIdx =
          presetMsgIdx !== null &&
          presetMsgIdx !== undefined &&
          MESSAGES[presetMsgIdx]
            ? Number(presetMsgIdx)
            : pickRandom(MESSAGES);
        showMessage(msgIdx);
        const songIdx =
          presetSongIdx !== null &&
          presetSongIdx !== undefined &&
          AUDIO_LIST[presetSongIdx]
            ? Number(presetSongIdx)
            : pickRandom(AUDIO_LIST);
        current.songIdx = songIdx;

        // handlers
        surpriseBtn.onclick = () => {
          const i = pickRandom(MESSAGES);
          showMessage(i);
          burstConfetti();
        };
        musicBtn.onclick = () => {
          // try play selected
          try {
            playSong(current.songIdx);
          } catch (e) {
            console.error(e);
            alert("æ’­æ”¾å¤±è´¥ï¼Œæ£€æŸ¥éŸ³é¢‘è·¯å¾„æˆ–æµè§ˆå™¨ç­–ç•¥");
          }
        };
        fixBtn.onclick = makeShareLink;

        // small tip in subline
        sub.innerText = "ç‚¹å‡»â€œç‚¹æˆ‘æŠ½ä¸€æ¡ç¥ç¦â€æˆ–â€œæ’­æ”¾éšæœºæ­Œæ›²â€å¼€å§‹å§ã€‚";
      }

      window.addEventListener("load", init);
      window.addEventListener("resize", () => {
        // clear confetti canvas size on resize
        const canvas = document.getElementById("confetti");
        const ctx = canvas.getContext && canvas.getContext("2d");
        if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
      });
    </script>
  </body>
</html>
